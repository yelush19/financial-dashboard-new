# ğŸ“‹ ×ª×•×›× ×™×ª ×©×“×¨×•×’ - ×“×•×— ×¨×•×•×— ×•×”×¤×¡×“ ×—×•×“×©×™
**×ª××¨×™×š:** 20 ××•×§×˜×•×‘×¨ 2025  
**×§×‘×¦×™× ×‘××¢×¨×›×ª:** 7 ×§×‘×¦×™× ×¢×•×‘×“×™× (×œ× ×œ×™×¦×•×¨ ×—×“×©×™×!)

---

## ğŸ¯ ×¡×™×›×•× ×”×©×“×¨×•×’ - drill-down ×—×•×“×©×™

×”×•×¡×¤×ª 3 ×¨××•×ª ×‘×™××•×¨ **×œ×›×œ ×—×•×“×© ×‘× ×¤×¨×“**:

| ×¨××” | ××” ×¨×•××™× | ×“×•×’××” | ×¤×¢×•×œ×” |
|-----|-----------|--------|--------|
| **×¨××” 1 (×§×™×™××ª)** | ×§×•×“ ××™×•×Ÿ 800 - ×¢×œ×•×ª ××›×¨ | ×™× ×•××¨: 50,000 \| ×¤×‘×¨×•××¨: 45,000 \| ××¨×¥: 60,000 | **×œ×—×¥ ×¢×œ ×—×•×“×©** (×œ××©×œ ×™× ×•××¨) |
| **×¨××” 2 (×—×“×©×”)** | ×¤×™×¨×•×˜ ×œ×¤×™ ××¤×ª×— ×—×©×‘×•×Ÿ | **×¨×§ ×‘×™× ×•××¨:** ×—×©×‘×•×Ÿ 45003: 30,000 \| ×—×©×‘×•×Ÿ 50004: 20,000 | **×œ×—×¥ ×¢×œ ×—×©×‘×•×Ÿ ×‘×™× ×•××¨** |
| **×¨××” 3 (×—×“×©×”)** | ×¤×™×¨×•×˜ ×œ×¤×™ ×—-×Ÿ × ×’×“×™ (×¡×¤×§×™×) | **×¨×§ ×‘×™× ×•××¨, ×¨×§ ×œ×—×©×‘×•×Ÿ 45003:** ×¡×¤×§ 20035: 18,000 \| ×¡×¤×§ 30000: 12,000 | **×œ×—×¥ ×¢×œ ×¡×¤×§** |
| **×¨××” 4 (×—×“×©×”)** | ×ª× ×•×¢×•×ª ×¤×¨×˜× ×™×•×ª | **×¨×§ ×ª× ×•×¢×•×ª ×©×œ ×¡×¤×§ 20035 ×‘×™× ×•××¨ ×œ×—×©×‘×•×Ÿ 45003** | BiurModal |

**×—×¨×™×’×”:** ××¤×ª×— 40000 + ×—-×Ÿ × ×’×“×™ 30000 = **×¡×™×›×•× ×—×•×“×©×™ ×‘×œ×‘×“** (×œ×œ× ××¤×©×¨×•×ª ×œ×—×™×¦×” - ×¨×›×™×©×•×ª ×œ×§×•×—×•×ª ×‘××ª×¨)

---

## ğŸ’¡ ×”×¨×¢×™×•×Ÿ ×”××¨×›×–×™

**×”×œ×§×•×— ×¨×•×¦×” ×œ×¢× ×•×ª ×¢×œ ×”×©××œ×”:**
> "×‘×—×•×“×© ×™× ×•××¨ ×”×™×ª×” ×¢×œ×•×ª ××›×¨ ×©×œ 50,000 â‚ª - **××™ ×”×¡×¤×§×™× ×©×”×¨×›×™×‘×• ××ª ×–×”?**"

**×–×¨×™××ª ×”×§×œ×™×§×™×:**
```
×§×•×“ 800: ×™× ×•××¨ 50,000 â‚ª
    â†“ (×œ×—×™×¦×” ×¢×œ ×”×ª× "×™× ×•××¨")
    
×—×©×‘×•×Ÿ 45003: 30,000 â‚ª  â† ×¨×§ ×‘×™× ×•××¨!
×—×©×‘×•×Ÿ 50004: 20,000 â‚ª  â† ×¨×§ ×‘×™× ×•××¨!
    â†“ (×œ×—×™×¦×” ×¢×œ ×—×©×‘×•×Ÿ 45003)
    
×¡×¤×§ 20035: 18,000 â‚ª   â† ×¨×§ ×‘×™× ×•××¨, ×¨×§ ×œ×—×©×‘×•×Ÿ 45003!
×¡×¤×§ 30000: 12,000 â‚ª   â† ×¨×§ ×‘×™× ×•××¨, ×¨×§ ×œ×—×©×‘×•×Ÿ 45003!
    â†“ (×œ×—×™×¦×” ×¢×œ ×¡×¤×§ 20035)
    
×ª× ×•×¢×•×ª: 5 ×ª× ×•×¢×•×ª ×©×œ ×¡×¤×§ 20035 ×‘×™× ×•××¨ â† BiurModal
```

**×›×œ ×¨××” = ×¤×™×¨×•×˜ ×©×œ ×”×—×•×“×© ×©× ×œ×—×¥ ×¢×œ×™×•!**

---

## âš ï¸ ×”×—×¨×™×’×” ×”×—×©×•×‘×” - ×”×›× ×¡×•×ª ××”××ª×¨

**×©×•×¨×ª "×”×›× ×¡×•×ª ××›×™×¨×•×ª - ××ª×¨" (×—×©×‘×•×Ÿ 40000 + ×—-×Ÿ × ×’×“×™ 30000):**
- âœ… ××¦×™×’×” ×¡×›×•××™× ×—×•×“×©×™×™× ×¨×’×™×œ×™×
- âŒ **××™×Ÿ ××¤×©×¨×•×ª ×œ×—×™×¦×” ×¢×œ ×”×—×•×“×©×™×** 
- ğŸ’¡ **×¡×™×‘×”:** 16,845 ×ª× ×•×¢×•×ª ×©×œ ×¨×›×™×©×•×ª ×œ×§×•×—×•×ª - ××™×Ÿ ××©××¢×•×ª ×œ× ×™×ª×•×— PnL
- ğŸ¨ **×¢×™×¦×•×‘:** ×”×ª××™× ×œ× ×™×”×™×• clickable (×œ×œ× hover effect)

---

## ğŸ—‚ï¸ ××‘× ×” ×§×‘×¦×™× ×§×™×™××™×

```
MonthlyReport/
â”œâ”€â”€ index.tsx              â† ×”×§×•×‘×¥ ×”×¨××©×™ (250 ×©×•×¨×•×ª)
â”œâ”€â”€ BiurModal.tsx          â† ×—×œ×•×Ÿ ×ª× ×•×¢×•×ª (×§×™×™×, ×œ×©×“×¨×’)
â”œâ”€â”€ CategoryRow.tsx        â† ×©×•×¨×ª ×§×˜×’×•×¨×™×” (×œ×©×“×¨×’)
â”œâ”€â”€ VendorRow.tsx          â† ×©×•×¨×ª ×¡×¤×§ (× ×—×œ×™×£ ×‘×©×•×¨×ª ×—×©×‘×•×Ÿ)
â”œâ”€â”€ TableHeader.tsx        â† ×›×•×ª×¨×•×ª ×˜×‘×œ×” (×œ×œ× ×©×™× ×•×™)
â”œâ”€â”€ AdjustmentRow.tsx      â† ×”×ª×××•×ª (×œ×œ× ×©×™× ×•×™)
â””â”€â”€ StatsCards.tsx         â† ×›×¨×˜×™×¡×™ ×¡×˜×˜×™×¡×˜×™×§×” (×œ×œ× ×©×™× ×•×™)
```

---

## ğŸ”§ ×©×œ×‘×™ ×”×¢×‘×•×“×” - ×’×™×©×” ×—×“×©×”!

### **âœ… ××¢×¨×›×ª ××œ××™ - ××©×•×“×¨×’×ª ×œ×¨×‘-×©× ×ª×™!**

**×—×œ×•×Ÿ ×¢×“×›×•×Ÿ ××œ××™ ×—×›× ×¢× ××¢×‘×¨ ×‘×™×Ÿ ×©× ×™×:**

#### ×”×§×•××¤×•× × ×˜: `InventoryEditorModal.tsx` (×‘××¨×˜×™×¤××§×˜ × ×¤×¨×“!)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“¦ ×¢×“×›×•×Ÿ ××œ××™                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ×—×•×“×© ×•×©× ×”  â”‚ ××œ××™ ×¤×ª×™×—×”  â”‚ ××œ××™ ×¡×’×™×¨×”  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ××•×§×˜×•×‘×¨ 25  â”‚  720,000     â”‚ [730,000] âœï¸ â”‚
â”‚ × ×•×‘××‘×¨ 25   â”‚  730,000 âš¡  â”‚ [740,000] âœï¸ â”‚
â”‚ ×“×¦××‘×¨ 25    â”‚  740,000 âš¡  â”‚ [750,000] âœï¸ â”‚ â†’ ×™×•×¢×‘×¨
â”‚ ×™× ×•××¨ 26    â”‚  750,000 âš¡  â”‚ [760,000] âœï¸ â”‚ â† ××“×¦××‘×¨!
â”‚ ×¤×‘×¨×•××¨ 26   â”‚  760,000 âš¡  â”‚ [770,000] âœï¸ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ×ª×›×•× ×•×ª ××™×•×—×“×•×ª:
- âœ… **×¤×•×¨××˜ YYYY-MM** - "2025-12", "2026-01" ×•×›×•'
- âœ… **××¢×‘×¨ ×©× ×™× ××•×˜×•××˜×™** - ×“×¦××‘×¨ 2025 â†’ ×™× ×•××¨ 2026
- âœ… **×–×™×”×•×™ ×—×•×“×©×™× ×—×›×** - ××–×”×” ××”× ×ª×•× ×™× ×”×§×™×™××™×
- âœ… **××™× ×“×™×§×˜×•×¨ ×”×¢×‘×¨×”** - ×¨×•××™× ×—×¥ ×™×¨×•×§ "×™×•×¢×‘×¨"
- âœ… **×¤×•×¨××˜ ×¢× ×¤×¡×™×§×™×** - 750,000

#### ××™×š ×–×” ×¢×•×‘×“ ×‘×§×•×“:
```typescript
interface Inventory {
  [monthKey: string]: number;  // "2025-12": 750000
}

// ×“×•×’××”:
openingInventory = {
  "2025-12": 740000,
  "2026-01": 740000,  // â† ×”×¢×ª×§×” ××•×˜×•××˜×™×ª
  "2026-02": 750000
}
```

#### ×©×™× ×•×™×™× × ×“×¨×©×™× ×‘-index.tsx:
**×”×××©×§ ×”× ×•×›×—×™ ××©×ª××© ×‘××¡×¤×¨×™× (1-12), ×¦×¨×™×š ×œ×©× ×•×ª ×œ×¤×•×¨××˜ YYYY-MM!**

**×–××Ÿ ×”×•×¡×¤×”:** 15 ×“×§×•×ª (×›×•×œ×œ ×”××¨×ª ×”×¤×•×¨××˜)

---

### **×©×œ×‘ 1: ×”×•×¡×¤×ª InventoryEditorModal ×¨×‘-×©× ×ª×™** â±ï¸ 15 ×“×§'

**×§×•×‘×¥ ×—×“×©:** `InventoryEditorModal.tsx` 

**ğŸ“¦ ×”×§×•×“ ×”××œ× × ××¦× ×‘××¨×˜×™×¤××§×˜ × ×¤×¨×“ ×‘×©× "InventoryEditorModal - ×§×•××¤×•× × ×˜ ××•×›×Ÿ ×œ×”×¢×ª×§×”"**

**××” ×œ×¢×©×•×ª:**
1. ×¦×•×¨ ×§×•×‘×¥: `src/components/reports/MonthlyReport/InventoryEditorModal.tsx`
2. **×”×¢×ª×§ ××ª ×›×œ ×”×§×•×“ ××”××¨×˜×™×¤××§×˜ ×”× ×¤×¨×“** (×œ× ××”×ª×•×›× ×™×ª ×”×–×•!)
3. ×©××•×¨

**âš ï¸ ×—×©×•×‘:** ×”×§×•××¤×•× × ×˜ ××©×ª××© ×‘×¤×•×¨××˜ `YYYY-MM` (×œ×“×•×’××”: "2025-01", "2026-12").
×× ×”××¢×¨×›×ª ×”× ×•×›×—×™×ª ×©×œ×š ××©×ª××©×ª ×‘××¡×¤×¨×™× ×¤×©×•×˜×™× (1-12), ×ª×¦×˜×¨×š ×œ×”××™×¨!

---

### **×©×œ×‘ 2: ×”××¨×ª ×¤×•×¨××˜ ××œ××™ (×× × ×“×¨×©)** â±ï¸ 10 ×“×§'

**×§×•×‘×¥:** `index.tsx`

**×× ×”××¢×¨×›×ª ×”× ×•×›×—×™×ª ×©×œ×š ××©×ª××©×ª ×‘××¡×¤×¨×™× ×¤×©×•×˜×™×:**

```typescript
// âŒ ×¤×•×¨××˜ ×™×©×Ÿ
openingInventory = {
  1: 650000,    // ×™× ×•××¨
  2: 680000,    // ×¤×‘×¨×•××¨
  ...
}

// âœ… ×¤×•×¨××˜ ×—×“×© ×¨×‘-×©× ×ª×™
openingInventory = {
  "2025-01": 650000,
  "2025-02": 680000,
  ...
}
```

**×¤×•× ×§×¦×™×™×ª ×”××¨×”:**
```typescript
// ×”××¨×” ××¤×•×¨××˜ ×™×©×Ÿ ×œ×—×“×©
const convertInventoryFormat = (oldFormat: {[month: number]: number}, year: number = 2025) => {
  const newFormat: {[key: string]: number} = {};
  Object.entries(oldFormat).forEach(([month, value]) => {
    const monthKey = `${year}-${String(month).padStart(2, '0')}`;
    newFormat[monthKey] = value;
  });
  return newFormat;
};

// ×”××¨×” ××¤×•×¨××˜ ×—×“×© ×œ×™×©×Ÿ (×œ×ª××™××•×ª ×¢× ×§×•×“ ×§×™×™×)
const getMonthValue = (inventory: {[key: string]: number}, month: number, year: number = 2025) => {
  const monthKey = `${year}-${String(month).padStart(2, '0')}`;
  return inventory[monthKey] || 0;
};
```

**×¢×“×›×•×Ÿ ×‘×˜×¢×™× ×”:**
```typescript
useEffect(() => {
  // ×˜×¢×™× ×” ×-localStorage
  const savedOpening = localStorage.getItem(STORAGE_KEYS.OPENING_INVENTORY);
  if (savedOpening) {
    const parsed = JSON.parse(savedOpening);
    // ×‘×“×™×§×” ×× ×–×” ×¤×•×¨××˜ ×™×©×Ÿ (××¡×¤×¨×™×) ××• ×—×“×© (××—×¨×•×–×•×ª)
    const firstKey = Object.keys(parsed)[0];
    if (!isNaN(Number(firstKey))) {
      // ×¤×•×¨××˜ ×™×©×Ÿ - ×”××¨×”
      setOpeningInventory(convertInventoryFormat(parsed, 2025));
    } else {
      // ×¤×•×¨××˜ ×—×“×©
      setOpeningInventory(parsed);
    }
  }
}, []);
```

**âš ï¸ ×× ×”××¢×¨×›×ª ×›×‘×¨ ××©×ª××©×ª ×‘-YYYY-MM - ×“×œ×’ ×¢×œ ×©×œ×‘ ×–×”!**

---

### **×©×œ×‘ 3: ×—×™×‘×•×¨ ×”××•×“×œ ×œ-index.tsx** â±ï¸ 8 ×“×§'

**×§×•×‘×¥:** `index.tsx`

#### 3.1 Import (×©×•×¨×” ~30):
```typescript
import { InventoryEditorModal } from './InventoryEditorModal';
import { Package } from 'lucide-react'; // ×× ×¢×“×™×™×Ÿ ×œ× ××™×•×‘×
```

#### 3.2 ×”×•×¡×£ State (×©×•×¨×” ~50):
```typescript
const [showInventoryEditor, setShowInventoryEditor] = useState(false);
```

#### 3.3 ×¤×•× ×§×¦×™×™×ª ×©××™×¨×” (×©×•×¨×” ~100):
```typescript
const handleInventorySave = (opening: Inventory, closing: Inventory) => {
  setOpeningInventory(opening);
  setClosingInventory(closing);
  
  // ×©××™×¨×” ×‘-localStorage
  localStorage.setItem(STORAGE_KEYS.OPENING_INVENTORY, JSON.stringify(opening));
  localStorage.setItem(STORAGE_KEYS.CLOSING_INVENTORY, JSON.stringify(closing));
  
  console.log('âœ… ××œ××™ ×¢×•×“×›×Ÿ:', { opening, closing });
};
```

#### 3.4 ×”×•×¡×£ ×›×¤×ª×•×¨ "×¢×“×›×Ÿ ××œ××™" (×©×•×¨×” ~450):

××¦× ××ª `InventoryBackupControls` ×•×”×•×¡×£ ×›×¤×ª×•×¨ ×œ×¤× ×™×•:

```typescript
<div style={{ display: 'flex', gap: '8px', marginBottom: '12px', flexWrap: 'wrap' }}>
  {/* ×›×¤×ª×•×¨ ×—×“×© - ×¢×“×›×Ÿ ××œ××™ */}
  <button
    onClick={() => setShowInventoryEditor(true)}
    style={{
      display: 'flex',
      alignItems: 'center',
      gap: '6px',
      padding: '8px 16px',
      background: '#8b5cf6',
      color: 'white',
      border: 'none',
      borderRadius: '6px',
      fontSize: '14px',
      fontWeight: '600',
      cursor: 'pointer',
      transition: 'background 0.2s'
    }}
    onMouseEnter={(e) => e.currentTarget.style.background = '#7c3aed'}
    onMouseLeave={(e) => e.currentTarget.style.background = '#8b5cf6'}
  >
    <Package size={16} />
    ×¢×“×›×Ÿ ××œ××™
  </button>
</div>

{/* ×”×§×•××¤×•× × ×˜ ×”×§×™×™× */}
<InventoryBackupControls
  openingInventory={openingInventory}
  closingInventory={closingInventory}
  onImport={handleInventoryImport}
/>
```

#### 3.5 ×”×•×¡×£ ××ª ×”××•×“×œ ×œ×¤× ×™ ×¡×’×™×¨×ª ×”-render (×©×•×¨×” ~700):
```typescript
      {/* InventoryEditorModal */}
      <InventoryEditorModal
        isOpen={showInventoryEditor}
        onClose={() => setShowInventoryEditor(false)}
        openingInventory={openingInventory}
        closingInventory={closingInventory}
        onSave={handleInventorySave}
        formatCurrency={formatCurrency}
      />

      {/* DrillDownModal - ×™×•×•×¦×¨ ×‘×©×œ×‘×™× ×”×‘××™× */}
      ...
```

---

### **×©×œ×‘ 4: ×”×•×¡×¤×ª State ×œ× ×™×”×•×œ drill-down** â±ï¸ 3 ×“×§'

**×§×•×‘×¥:** `index.tsx`

×”×•×¡×£ state ×—×“×© (××—×¨×™ ×©×•×¨×” 50):

```typescript
// State ×œ× ×™×”×•×œ drill-down ×—×•×“×©×™
const [drillDownState, setDrillDownState] = useState<{
  categoryCode?: number | string;
  month?: number;
  accountKey?: number;
}>({});

// ×¤×•× ×§×¦×™×•×ª ×œ× ×™×”×•×œ drill-down
const openAccountsDrillDown = (categoryCode: number | string, month: number) => {
  setDrillDownState({ categoryCode, month });
};

const openCounterAccountsDrillDown = (categoryCode: number | string, month: number, accountKey: number) => {
  setDrillDownState({ categoryCode, month, accountKey });
};

const closeDrillDown = () => {
  setDrillDownState({});
};
```

---

### **×©×œ×‘ 4: ×™×¦×™×¨×ª ×§×•××¤×•× × ×˜ DrillDownModal** â±ï¸ 20 ×“×§'

**×§×•×‘×¥ ×—×“×©:** `DrillDownModal.tsx`

```typescript
// src/components/reports/MonthlyReport/DrillDownModal.tsx

import React, { useMemo } from 'react';
import { X, ChevronLeft } from 'lucide-react';
import { Transaction } from '../../../types/reportTypes';
import _ from 'lodash';

interface DrillDownModalProps {
  isOpen: boolean;
  onClose: () => void;
  transactions: Transaction[];
  categoryCode: number | string;
  categoryName: string;
  month: number;
  monthName: string;
  accountKey?: number;
  formatCurrency: (amount: number) => string;
  onSelectAccount?: (accountKey: number) => void;
  onShowTransactions?: (counterAccount: number) => void;
}

export const DrillDownModal: React.FC<DrillDownModalProps> = ({
  isOpen,
  onClose,
  transactions,
  categoryCode,
  categoryName,
  month,
  monthName,
  accountKey,
  formatCurrency,
  onSelectAccount,
  onShowTransactions
}) => {
  if (!isOpen) return null;

  // ×¡×™× ×•×Ÿ ×ª× ×•×¢×•×ª ×œ×¤×™ ×§×•×“ ××™×•×Ÿ ×•×—×•×“×©
  const filteredTransactions = useMemo(() => {
    return transactions.filter(tx => {
      // ×‘×“×™×§×ª ×§×•×“ ××™×•×Ÿ ××™×•×—×“
      if (categoryCode === 'income_site') {
        return tx.sortCode === 600 && tx.counterAccountNumber !== 37999 && tx.month === month;
      }
      if (categoryCode === 'income_superpharm') {
        return tx.sortCode === 600 && tx.counterAccountNumber === 37999 && tx.month === month;
      }
      return tx.sortCode === categoryCode && tx.month === month;
    });
  }, [transactions, categoryCode, month]);

  // ×¨××” 2: ×§×™×‘×•×¥ ×œ×¤×™ ××¤×ª×— ×—×©×‘×•×Ÿ (×× ×œ× × ×‘×—×¨ ×—×©×‘×•×Ÿ)
  const accountsData = useMemo(() => {
    if (accountKey) return null;
    
    const grouped = _.groupBy(filteredTransactions, 'accountKey');
    return Object.entries(grouped).map(([key, txs]) => ({
      accountKey: parseInt(key),
      accountName: txs[0].accountName,
      amount: txs.reduce((sum, tx) => sum + tx.amount, 0),
      count: txs.length
    })).sort((a, b) => Math.abs(b.amount) - Math.abs(a.amount));
  }, [filteredTransactions, accountKey]);

  // ×¨××” 3: ×§×™×‘×•×¥ ×œ×¤×™ ×—-×Ÿ × ×’×“×™ (×× × ×‘×—×¨ ×—×©×‘×•×Ÿ)
  const counterAccountsData = useMemo(() => {
    if (!accountKey) return null;
    
    const accountTxs = filteredTransactions.filter(tx => tx.accountKey === accountKey);
    const grouped = _.groupBy(accountTxs, 'counterAccountNumber');
    
    return Object.entries(grouped).map(([key, txs]) => ({
      counterAccount: parseInt(key),
      counterAccountName: txs[0].counterAccountName,
      amount: txs.reduce((sum, tx) => sum + tx.amount, 0),
      count: txs.length
    })).sort((a, b) => Math.abs(b.amount) - Math.abs(a.amount));
  }, [filteredTransactions, accountKey]);

  const totalAmount = filteredTransactions.reduce((sum, tx) => sum + tx.amount, 0);
  const selectedAccountName = accountKey 
    ? filteredTransactions.find(tx => tx.accountKey === accountKey)?.accountName 
    : null;

  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden">
        {/* ×›×•×ª×¨×ª */}
        <div className="flex items-center justify-between p-4 border-b bg-gradient-to-r from-emerald-50 to-teal-50">
          <div>
            <div className="flex items-center gap-2">
              {accountKey && (
                <button
                  onClick={() => onSelectAccount?.(0)}
                  className="p-1 hover:bg-gray-200 rounded"
                  title="×—×–×•×¨ ×œ×¨×©×™××ª ×—×©×‘×•× ×•×ª"
                >
                  <ChevronLeft className="w-5 h-5" />
                </button>
              )}
              <h3 className="text-lg font-bold text-gray-800">
                {categoryName} - {monthName}
                {accountKey && ` > ×—×©×‘×•×Ÿ ${accountKey} - ${selectedAccountName}`}
              </h3>
            </div>
            <p className="text-sm text-gray-600 mt-1">
              {filteredTransactions.length} ×ª× ×•×¢×•×ª | ×¡×”"×›: {formatCurrency(totalAmount)}
            </p>
          </div>
          <button
            onClick={onClose}
            className="text-gray-500 hover:text-gray-700 p-2 rounded-full hover:bg-gray-100"
          >
            <X className="w-6 h-6" />
          </button>
        </div>

        {/* ×ª×•×›×Ÿ */}
        <div className="p-4 overflow-auto max-h-[calc(90vh-120px)]">
          {/* ×¨××” 2: ×¨×©×™××ª ×—×©×‘×•× ×•×ª */}
          {accountsData && (
            <table className="w-full text-sm border-collapse">
              <thead className="bg-gray-100 sticky top-0">
                <tr>
                  <th className="border border-gray-300 px-4 py-2 text-right font-semibold">××¤×ª×— ×—×©×‘×•×Ÿ</th>
                  <th className="border border-gray-300 px-4 py-2 text-right font-semibold">×©× ×—×©×‘×•×Ÿ</th>
                  <th className="border border-gray-300 px-4 py-2 text-center font-semibold">××¡×¤×¨ ×ª× ×•×¢×•×ª</th>
                  <th className="border border-gray-300 px-4 py-2 text-left font-semibold">×¡×›×•×</th>
                </tr>
              </thead>
              <tbody>
                {accountsData.map(account => (
                  <tr 
                    key={account.accountKey}
                    className="hover:bg-blue-50 cursor-pointer transition-colors"
                    onClick={() => onSelectAccount?.(account.accountKey)}
                  >
                    <td className="border border-gray-300 px-4 py-2 font-medium text-blue-600">
                      {account.accountKey}
                    </td>
                    <td className="border border-gray-300 px-4 py-2">
                      {account.accountName}
                    </td>
                    <td className="border border-gray-300 px-4 py-2 text-center text-gray-600">
                      {account.count}
                    </td>
                    <td className="border border-gray-300 px-4 py-2 text-left font-medium">
                      {formatCurrency(Math.abs(account.amount))}
                    </td>
                  </tr>
                ))}
              </tbody>
              <tfoot className="bg-gray-100 sticky bottom-0">
                <tr>
                  <td colSpan={3} className="border border-gray-300 px-4 py-2 text-right font-bold">
                    ×¡×”"×›:
                  </td>
                  <td className="border border-gray-300 px-4 py-2 text-left font-bold">
                    {formatCurrency(Math.abs(totalAmount))}
                  </td>
                </tr>
              </tfoot>
            </table>
          )}

          {/* ×¨××” 3: ×¨×©×™××ª ×—-×Ÿ × ×’×“×™ (×¡×¤×§×™×) */}
          {counterAccountsData && (
            <table className="w-full text-sm border-collapse">
              <thead className="bg-gray-100 sticky top-0">
                <tr>
                  <th className="border border-gray-300 px-4 py-2 text-right font-semibold">×—-×Ÿ × ×’×“×™</th>
                  <th className="border border-gray-300 px-4 py-2 text-right font-semibold">×©×</th>
                  <th className="border border-gray-300 px-4 py-2 text-center font-semibold">××¡×¤×¨ ×ª× ×•×¢×•×ª</th>
                  <th className="border border-gray-300 px-4 py-2 text-left font-semibold">×¡×›×•×</th>
                </tr>
              </thead>
              <tbody>
                {counterAccountsData.map(counter => (
                  <tr 
                    key={counter.counterAccount}
                    className="hover:bg-purple-50 cursor-pointer transition-colors"
                    onClick={() => onShowTransactions?.(counter.counterAccount)}
                  >
                    <td className="border border-gray-300 px-4 py-2 font-medium text-purple-600">
                      {counter.counterAccount}
                    </td>
                    <td className="border border-gray-300 px-4 py-2">
                      {counter.counterAccountName}
                    </td>
                    <td className="border border-gray-300 px-4 py-2 text-center text-gray-600">
                      {counter.count}
                    </td>
                    <td className="border border-gray-300 px-4 py-2 text-left font-medium">
                      {formatCurrency(Math.abs(counter.amount))}
                    </td>
                  </tr>
                ))}
              </tbody>
              <tfoot className="bg-gray-100 sticky bottom-0">
                <tr>
                  <td colSpan={3} className="border border-gray-300 px-4 py-2 text-right font-bold">
                    ×¡×”"×›:
                  </td>
                  <td className="border border-gray-300 px-4 py-2 text-left font-bold">
                    {formatCurrency(Math.abs(totalAmount))}
                  </td>
                </tr>
              </tfoot>
            </table>
          )}
        </div>
      </div>
    </div>
  );
};
```

---

### **×©×œ×‘ 5: ×¢×“×›×•×Ÿ CategoryRow ×œ×ª××™×›×” ×‘×œ×—×™×¦×” ×¢×œ ×—×•×“×©** â±ï¸ 10 ×“×§'

**×§×•×‘×¥:** `CategoryRow.tsx`

××¦× ××ª ×”×©×•×¨×” ×©××¦×™×’×” ××ª ×”×¡×›×•××™× ×”×—×•×“×©×™×™× (×‘×¢×¨×š ×©×•×¨×” 30-40) ×•×”×•×¡×£ `onClick`:

```typescript
{months.map(m => {
  // ×‘×“×™×§×” ×× ×–×• ×”×—×¨×™×’×” - ×”×›× ×¡×•×ª ××”××ª×¨
  const isException = (
    (category.code === 'income_site' || category.code === 'income_superpharm') &&
    // ×›××Ÿ ×¦×¨×™×š ×œ×‘×“×•×§ ×× ×›×œ ×”×ª× ×•×¢×•×ª ×”×Ÿ 40000+30000
    // × ×¢×©×” ××ª ×–×” ×‘×¦×“ ×”×¤×•× ×§×¦×™×”
  );
  
  return (
    <td 
      key={m} 
      className={`border border-gray-300 px-3 py-2 text-center ${
        !isException ? 'hover:bg-blue-50 cursor-pointer' : ''
      } transition-colors`}
      onClick={(e) => {
        e.stopPropagation(); // ×œ×× ×•×¢ ×”×¨×—×‘×ª ×”×§×˜×’×•×¨×™×”
        onMonthClick(m); // ×ª×§×¨× ×œ×¤×•× ×§×¦×™×” ×©×‘×•×“×§×ª ×—×¨×™×’×”
      }}
    >
      {category.type === 'income'
        ? formatCurrency(category.data[m] || 0)
        : formatCurrency(Math.abs(category.data[m] || 0))
      }
    </td>
  );
})}
```

**×’×™×©×” ×¤×©×•×˜×” ×™×•×ª×¨ - ×”×‘×“×™×§×” ×ª×”×™×” ×‘×¤×•× ×§×¦×™×” handleMonthClick!**

```typescript
{months.map(m => (
  <td 
    key={m} 
    className="border border-gray-300 px-3 py-2 text-center hover:bg-blue-50 cursor-pointer transition-colors"
    onClick={(e) => {
      e.stopPropagation();
      onMonthClick(m); // ×”×¤×•× ×§×¦×™×” ×ª×—×œ×™×˜ ×× ×œ×¤×ª×•×— ××• ×œ×
    }}
  >
    {category.type === 'income'
      ? formatCurrency(category.data[m] || 0)
      : formatCurrency(Math.abs(category.data[m] || 0))
    }
  </td>
))}
```

×”×•×¡×£ prop ×—×“×©:
```typescript
interface CategoryRowProps {
  // ... props ×§×™×™××™×
  onMonthClick: (month: number) => void;  // â† ×”×•×¡×£ ×–×”
}
```

---

### **×©×œ×‘ 6: ×—×™×‘×•×¨ DrillDownModal ×œ-index.tsx** â±ï¸ 15 ×“×§'

**×§×•×‘×¥:** `index.tsx`

#### 4.1 Import ×”××•×“×œ ×”×—×“×© (×©×•×¨×” 30):
```typescript
import { DrillDownModal } from './DrillDownModal';
```

#### 4.2 ×”×•×¡×£ ×¤×•× ×§×¦×™×•×ª ×˜×™×¤×•×œ (××—×¨×™ state, ×©×•×¨×” ~70):
```typescript
// ×¤×ª×™×—×ª drill-down ×œ×—×©×‘×•× ×•×ª
const handleMonthClick = (category: CategoryData, month: number) => {
  // ×‘×“×™×§×” ×× ×–×• ×”×—×¨×™×’×” (40000 + 30000) - ×”×›× ×¡×•×ª ××”××ª×¨
  if (category.code === 'income_site' || category.code === 'income_superpharm') {
    const allTxs = transactions.filter(tx => {
      if (category.code === 'income_site') {
        return tx.sortCode === 600 && tx.counterAccountNumber !== 37999;
      }
      return tx.sortCode === 600 && tx.counterAccountNumber === 37999;
    });
    
    // ×× ×›×•×œ× ×—×©×‘×•×Ÿ 40000 ×¢× ×—-×Ÿ × ×’×“×™ 30000 - ×œ× ×¢×•×©×™× ×›×œ×•×!
    const isException = allTxs.every(tx => 
      tx.accountKey === 40000 && tx.counterAccountNumber === 30000
    );
    
    if (isException) {
      // âŒ ×œ× ×¢×•×©×™× ×›×œ×•× - ×–×” ×¨×›×™×©×•×ª ×œ×§×•×—×•×ª, ××™×Ÿ ×˜×¢× ×œ×”×¦×™×’
      console.log('×”×›× ×¡×•×ª ××”××ª×¨ - ××™×Ÿ drill-down');
      return;
    }
  }
  
  // ××§×¨×” ×¨×’×™×œ - ×¤×ª×— drill down
  setDrillDownState({
    categoryCode: category.code,
    month
  });
};

// ××¢×‘×¨ ×œ×¨××ª ×¡×¤×§×™× (×—-×Ÿ × ×’×“×™)
const handleAccountSelect = (accountKey: number) => {
  if (accountKey === 0) {
    // ×—×–×¨×” ×œ×¨××ª ×—×©×‘×•× ×•×ª
    setDrillDownState(prev => ({
      categoryCode: prev.categoryCode,
      month: prev.month
    }));
  } else {
    // ××¢×‘×¨ ×œ×¨××ª ×¡×¤×§×™×
    setDrillDownState(prev => ({
      ...prev,
      accountKey
    }));
  }
};

// ×”×¦×’×ª ×ª× ×•×¢×•×ª ×¡×¤×§ ××¡×•×™×
const handleShowCounterTransactions = (counterAccount: number) => {
  if (!drillDownState.categoryCode || !drillDownState.month || !drillDownState.accountKey) return;
  
  const category = monthlyData.categories.find(c => c.code === drillDownState.categoryCode);
  if (!category) return;
  
  // ×¡×™× ×•×Ÿ ×ª× ×•×¢×•×ª
  let txs = transactions.filter(tx => {
    if (category.code === 'income_site') {
      return tx.sortCode === 600 && 
             tx.counterAccountNumber !== 37999 && 
             tx.month === drillDownState.month &&
             tx.accountKey === drillDownState.accountKey &&
             tx.counterAccountNumber === counterAccount;
    }
    if (category.code === 'income_superpharm') {
      return tx.sortCode === 600 && 
             tx.counterAccountNumber === 37999 && 
             tx.month === drillDownState.month &&
             tx.accountKey === drillDownState.accountKey &&
             tx.counterAccountNumber === counterAccount;
    }
    return tx.sortCode === category.code && 
           tx.month === drillDownState.month &&
           tx.accountKey === drillDownState.accountKey &&
           tx.counterAccountNumber === counterAccount;
  });
  
  const accountName = txs[0]?.accountName || '';
  const counterName = txs[0]?.counterAccountName || '';
  
  setBiurData({
    title: `${category.name} - ${MONTH_NAMES[drillDownState.month - 1]} - ×—×©×‘×•×Ÿ ${drillDownState.accountKey} (${accountName}) - ×¡×¤×§ ${counterAccount} (${counterName})`,
    transactions: txs
  });
  setShowBiurModal(true);
};
```

#### 4.3 ×¢×“×›×Ÿ ××ª CategoryRow ×‘×ª×•×š ×”-render (×©×•×¨×” ~450):
```typescript
<CategoryRow
  category={cat}
  months={monthlyData.months}
  isExpanded={expandedCategories.has(String(cat.code))}
  onToggle={() => toggleCategory(String(cat.code))}
  onShowBiur={(month) => handleShowBiur(cat, month)}
  onMonthClick={(month) => handleMonthClick(cat, month)} // â† ×”×•×¡×£ ×–×”
  formatCurrency={formatCurrency}
  bgColor="bg-orange-50"
/>
```

#### 4.4 ×”×•×¡×£ ××ª DrillDownModal ×œ×¤× ×™ ×¡×’×™×¨×ª ×”-div ×”×¨××©×™ (×©×•×¨×” ~700):
```typescript
      {/* DrillDownModal */}
      <DrillDownModal
        isOpen={!!drillDownState.categoryCode}
        onClose={closeDrillDown}
        transactions={transactions}
        categoryCode={drillDownState.categoryCode || 0}
        categoryName={
          monthlyData.categories.find(c => c.code === drillDownState.categoryCode)?.name || ''
        }
        month={drillDownState.month || 1}
        monthName={MONTH_NAMES[(drillDownState.month || 1) - 1]}
        accountKey={drillDownState.accountKey}
        formatCurrency={formatCurrency}
        onSelectAccount={handleAccountSelect}
        onShowTransactions={handleShowCounterTransactions}
      />

      {/* BiurModal */}
      <BiurModal
        isOpen={showBiurModal}
        data={biurData}
        onClose={() => setShowBiurModal(false)}
        formatCurrency={formatCurrency}
      />
    </div>
  );
};
```

---

## âœ… ×¨×©×™××ª ×‘×™×§×•×¨×ª ×¡×•×¤×™×ª

### ×©×œ×‘×™ ×™×™×©×•×:
- [ ] **×©×œ×‘ 1:** ×”×•×¡×¤×ª State ×œ× ×™×”×•×œ drill-down (3 ×“×§')
- [ ] **×©×œ×‘ 2:** ×™×¦×™×¨×ª DrillDownModal.tsx (20 ×“×§')
- [ ] **×©×œ×‘ 3:** ×¢×“×›×•×Ÿ CategoryRow ×œ×ª××™×›×” ×‘×œ×—×™×¦×” ×¢×œ ×—×•×“×© (10 ×“×§')
- [ ] **×©×œ×‘ 4:** ×—×™×‘×•×¨ DrillDownModal ×œ-index.tsx (15 ×“×§')

### ×‘×“×™×§×•×ª:
- [ ] ×œ×—×™×¦×” ×¢×œ ×—×•×“×© ×‘×©×•×¨×ª ×§×•×“ ××™×•×Ÿ â†’ ×¤×•×ª×— ×¨×©×™××ª ×—×©×‘×•× ×•×ª
- [ ] ×œ×—×™×¦×” ×¢×œ ×—×©×‘×•×Ÿ â†’ ×¤×•×ª×— ×¨×©×™××ª ×¡×¤×§×™× (×—-×Ÿ × ×’×“×™)
- [ ] ×œ×—×™×¦×” ×¢×œ ×¡×¤×§ â†’ ×¤×•×ª×— BiurModal ×¢× ×ª× ×•×¢×•×ª
- [ ] **×”×—×¨×™×’×” "×”×›× ×¡×•×ª ××›×™×¨×•×ª - ××ª×¨"** â†’ **×œ× ×§×•×¨×” ×›×œ×•× ×‘×œ×—×™×¦×”** (console.log ×‘×œ×‘×“)
- [ ] ×¦×‘×¢×™× × ×©××¨×™× (×©×—×•×¨, ×™×¨×•×§, ××¤×•×¨ ×‘×œ×‘×“)

---

## â±ï¸ ×–××Ÿ ××©×•×¢×¨ ×›×•×œ×œ: **50 ×“×§×•×ª**

## ğŸ¨ ×©××™×¨×” ×¢×œ ×”×¢×™×¦×•×‘

**×—×•×‘×” ×œ×©××•×¨:**
- âœ… ×¦×‘×¢ ×©×—×•×¨ ×œ×›×œ ×”×¡×›×•××™×
- âœ… ×¡×•×’×¨×™×™× ×œ××¡×¤×¨×™× ×©×œ×™×œ×™×™×  
- âœ… ×™×¨×•×§ ×¨×§ ×œ×›×•×ª×¨×•×ª ×¨××©×™×•×ª
- âœ… ××¤×•×¨ ×œ×¨×§×¢×™× ×•×§×•×•×™×
- âœ… ×›×—×•×œ ×œ×—×©×‘×•× ×•×ª (××¤×ª×— ×—×©×‘×•×Ÿ)
- âœ… ×¡×’×•×œ ×œ×¡×¤×§×™× (×—-×Ÿ × ×’×“×™)
- âœ… ×–×”×‘ ×¨×§ ×œ×¡×™×›×•××™× ×•-40000

---

## ğŸ“ ×”×¢×¨×•×ª ×—×©×•×‘×•×ª

1. **×’×™×©×ª drill-down ×—×•×“×©×™** - ×›×œ ×œ×—×™×¦×” ×¢×œ ×—×•×“×© ×¤×•×ª×—×ª ×—×œ×•×Ÿ ×—×“×©
2. **×œ× ×œ×™×¦×•×¨ ×§×‘×¦×™× ×¨×‘×™×** - ×¨×§ DrillDownModal.tsx ××—×“ ×—×“×©
3. **×—×™×©×•×‘ ×¨×§ ×œ×¤×™ ×ª.××¡××›** - ×–×” ×”×§×¨×™×˜×¨×™×•×Ÿ ×”×™×—×™×“!
4. **×”×—×¨×™×’×” 40000+30000** - âŒ **×œ×œ× ×›×œ ××¤×©×¨×•×ª ×œ×—×™×¦×”** - ×–×” ×¨×›×™×©×•×ª ×œ×§×•×—×•×ª (16,845 ×ª× ×•×¢×•×ª!)
5. **3 ×¨××•×ª ×‘×™××•×¨** - ×—×©×‘×•× ×•×ª â†’ ×¡×¤×§×™× â†’ ×ª× ×•×¢×•×ª
6. **×¢×™×¦×•×‘ ×”×—×¨×™×’×”** - ××¤×©×¨ ×œ×”×©××™×¨ hover effect ×›×¨×’×™×œ, ×”×¤×•× ×§×¦×™×” ×¤×©×•×˜ ×œ× ×ª×¢×©×” ×›×œ×•×

---

**××•×›×Ÿ ×œ×”×ª×—×™×œ? ğŸš€**